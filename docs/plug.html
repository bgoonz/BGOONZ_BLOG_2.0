<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
    <head>
        <meta charset="utf-8" />
        <meta name="generator" content="pandoc" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
        <title>Plug-ins</title>
        <style type="text/css">
            code {
                white-space: pre-wrap;
            }
            span.smallcaps {
                font-variant: small-caps;
            }
            span.underline {
                text-decoration: underline;
            }
            div.column {
                display: inline-block;
                vertical-align: top;
                width: 50%;
            }
        </style>
        <style type="text/css">
            a.sourceLine {
                display: inline-block;
                line-height: 1.25;
            }
            a.sourceLine {
                pointer-events: none;
                color: inherit;
                text-decoration: inherit;
            }
            a.sourceLine:empty {
                height: 1.2em;
            }
            .sourceCode {
                overflow: visible;
            }
            code.sourceCode {
                white-space: pre;
                position: relative;
            }
            div.sourceCode {
                margin: 1em 0;
            }
            pre.sourceCode {
                margin: 0;
            }
            @media screen {
                div.sourceCode {
                    overflow: auto;
                }
            }
            @media print {
                code.sourceCode {
                    white-space: pre-wrap;
                }
                a.sourceLine {
                    text-indent: -1em;
                    padding-left: 1em;
                }
            }
            pre.numberSource a.sourceLine {
                position: relative;
                left: -4em;
            }
            pre.numberSource a.sourceLine::before {
                content: attr(title);
                position: relative;
                left: -1em;
                text-align: right;
                vertical-align: baseline;
                border: none;
                pointer-events: all;
                display: inline-block;
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                -khtml-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
                padding: 0 4px;
                width: 4em;
                color: #aaaaaa;
            }
            pre.numberSource {
                margin-left: 3em;
                border-left: 1px solid #aaaaaa;
                padding-left: 4px;
            }
            div.sourceCode {
            }
            @media screen {
                a.sourceLine::before {
                    text-decoration: underline;
                }
            }
            code span.al {
                color: #ff0000;
                font-weight: bold;
            } /* Alert */
            code span.an {
                color: #60a0b0;
                font-weight: bold;
                font-style: italic;
            } /* Annotation */
            code span.at {
                color: #7d9029;
            } /* Attribute */
            code span.bn {
                color: #40a070;
            } /* BaseN */
            code span.bu {
            } /* BuiltIn */
            code span.cf {
                color: #007020;
                font-weight: bold;
            } /* ControlFlow */
            code span.ch {
                color: #4070a0;
            } /* Char */
            code span.cn {
                color: #880000;
            } /* Constant */
            code span.co {
                color: #60a0b0;
                font-style: italic;
            } /* Comment */
            code span.cv {
                color: #60a0b0;
                font-weight: bold;
                font-style: italic;
            } /* CommentVar */
            code span.do {
                color: #ba2121;
                font-style: italic;
            } /* Documentation */
            code span.dt {
                color: #902000;
            } /* DataType */
            code span.dv {
                color: #40a070;
            } /* DecVal */
            code span.er {
                color: #ff0000;
                font-weight: bold;
            } /* Error */
            code span.ex {
            } /* Extension */
            code span.fl {
                color: #40a070;
            } /* Float */
            code span.fu {
                color: #06287e;
            } /* Function */
            code span.im {
            } /* Import */
            code span.in {
                color: #60a0b0;
                font-weight: bold;
                font-style: italic;
            } /* Information */
            code span.kw {
                color: #007020;
                font-weight: bold;
            } /* Keyword */
            code span.op {
                color: #666666;
            } /* Operator */
            code span.ot {
                color: #007020;
            } /* Other */
            code span.pp {
                color: #bc7a00;
            } /* Preprocessor */
            code span.sc {
                color: #4070a0;
            } /* SpecialChar */
            code span.ss {
                color: #bb6688;
            } /* SpecialString */
            code span.st {
                color: #4070a0;
            } /* String */
            code span.va {
                color: #19177c;
            } /* Variable */
            code span.vs {
                color: #4070a0;
            } /* VerbatimString */
            code span.wa {
                color: #60a0b0;
                font-weight: bold;
                font-style: italic;
            } /* Warning */
        </style>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bgoonz/GIT-CDN-FILES/medium-basic-export.css" />
        <link rel="stylesheet" href="./medium.css" />
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/prism.min.js"
            integrity="sha512-axJX7DJduStuBB8ePC8ryGzacZPr3rdLaIDZitiEgWWk2gsXxEFlm4UW0iNzj2h3wp5mOylgHAzBzM4nRSvTZA=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        ></script>
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism-dark.min.css"
            integrity="sha512-Njdz7T/p6Ud1FiTMqH87bzDxaZBsVNebOWmacBjMdgWyeIhUSFU4V52oGwo3sT+ud+lyIE98sS291/zxBfozKw=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/prism.min.js" integrity="sha512-axJX7DJduStuBB8ePC8ryGzacZPr3rdLaIDZitiEgWWk2gsXxEFlm4UW0iNzj2h3wp5mOylgHAzBzM4nRSvTZA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><style></style><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism-dark.min.css" integrity="sha512-Njdz7T/p6Ud1FiTMqH87bzDxaZBsVNebOWmacBjMdgWyeIhUSFU4V52oGwo3sT+ud+lyIE98sS291/zxBfozKw==" crossorigin="anonymous" referrerpolicy="no-referrer" /></head>
    <body>
        <header id="title-block-header">
            <h1 class="title">Plug-ins</h1>
        </header>
        <div class="note">
            <p>
                <strong>Note:</strong> These are the gatsby plugins that power the file system of this website! <strong>See more in the Docs</strong> section.
            </p>
        </div>
        <h3 id="code">Code:</h3>
        <blockquote>
            <p>Gatsby Source File System</p>
        </blockquote>
        <pre><code>js
const path = require(&#39;path&#39;);
const fs = require(&#39;fs&#39;);
const { createFilePath } = require(&#39;gatsby-source-filesystem&#39;);
const _ = require(&#39;lodash&#39;);

function findFileNode({ node, getNode }) {
    let fileNode = node;
    let ids = [fileNode.id];

    while (fileNode &amp;&amp; fileNode.internal.type !== `File` &amp;&amp; fileNode.parent) {
        fileNode = getNode(fileNode.parent);

        if (!fileNode) {
            break;
        }

        if (_.includes(ids, fileNode.id)) {
            console.log(`found cyclic reference between nodes`);
            break;
        }

        ids.push(fileNode.id);
    }

    if (!fileNode || fileNode.internal.type !== `File`) {
        console.log(&#39;did not find ancestor File node&#39;);
        return null;
    }

    return fileNode;
}

exports.onCreateNode = ({ node, getNode, actions }, options) =&gt; {
    const { createNodeField } = actions;

    if (node.internal.type === &#39;MarkdownRemark&#39;) {
        let fileNode = findFileNode({ node, getNode });
        if (!fileNode) {
            throw new Error(&#39;could not find parent File node for MarkdownRemark node: &#39; + node);
        }

        let url;
        if (node.frontmatter.url) {
            url = node.frontmatter.url;
        } else if (_.get(options, &#39;uglyUrls&#39;, false)) {
            url = path.join(fileNode.relativeDirectory, fileNode.name + &#39;.html&#39;);
        } else {
            url = createFilePath({ node, getNode });
        }

        createNodeField({ node, name: &#39;url&#39;, value: url });
        createNodeField({
            node,
            name: &#39;absolutePath&#39;,
            value: fileNode.absolutePath
        });
        createNodeField({
            node,
            name: &#39;relativePath&#39;,
            value: fileNode.relativePath
        });
        createNodeField({ node, name: &#39;absoluteDir&#39;, value: fileNode.dir });
        createNodeField({
            node,
            name: &#39;relativeDir&#39;,
            value: fileNode.relativeDirectory
        });
        createNodeField({ node, name: &#39;base&#39;, value: fileNode.base });
        createNodeField({ node, name: &#39;ext&#39;, value: fileNode.ext });
        createNodeField({ node, name: &#39;name&#39;, value: fileNode.name });
    }
};

exports.createPages = ({ graphql, getNode, actions, getNodesByType }) =&gt; {
    const { createPage, deletePage } = actions;

    // Use GraphQL to bring only the &quot;id&quot; and &quot;html&quot; (added by gatsby-transformer-remark)
    // properties of the MarkdownRemark nodes. Don&#39;t bring additional fields
    // such as &quot;relativePath&quot;. Otherwise, Gatsby&#39;s GraphQL resolvers might infer
    // types these fields as File and change their structure. For example, the
    // &quot;html&quot; attribute exists only on a GraphQL node, but does not exist on the
    // underlying node.
    return graphql(`
        {
            allMarkdownRemark {
                edges {
                    node {
                        id
                        html
                    }
                }
            }
        }
    `).then((result) =&gt; {
        if (result.errors) {
            return Promise.reject(result.errors);
        }

        const nodes = result.data.allMarkdownRemark.edges.map(({ node }) =&gt; node);
        const siteNode = getNode(&#39;Site&#39;);
        const siteDataNode = getNode(&#39;SiteData&#39;);
        const sitePageNodes = getNodesByType(&#39;SitePage&#39;);
        const sitePageNodesByPath = _.keyBy(sitePageNodes, &#39;path&#39;);
        const siteData = _.get(siteDataNode, &#39;data&#39;, {});

        const pages = nodes.map((graphQLNode) =&gt; {
            // Use the node id to get the underlying node. It is not exactly the
            // same node returned by GraphQL, because GraphQL resolvers might
            // transform node fields.
            const node = getNode(graphQLNode.id);
            return {
                url: node.fields.url,
                relativePath: node.fields.relativePath,
                relativeDir: node.fields.relativeDir,
                base: node.fields.base,
                name: node.fields.name,
                frontmatter: node.frontmatter,
                html: graphQLNode.html
            };
        });

        nodes.forEach((graphQLNode) =&gt; {
            const node = getNode(graphQLNode.id);
            const url = node.fields.url;

            const template = node.frontmatter.template;
            if (!template) {
                console.error(`Error: undefined template for ${url}`);
                return;
            }

            const component = path.resolve(`./src/templates/${template}.js`);
            if (!fs.existsSync(component)) {
                console.error(`Error: component &quot;src/templates/${template}.js&quot; missing for ${url}`);
                return;
            }

            const existingPageNode = _.get(sitePageNodesByPath, url);

            const page = {
                path: url,
                component: component,
                context: {
                    url: url,
                    relativePath: node.fields.relativePath,
                    relativeDir: node.fields.relativeDir,
                    base: node.fields.base,
                    name: node.fields.name,
                    frontmatter: node.frontmatter,
                    html: graphQLNode.html,
                    pages: pages,
                    site: {
                        siteMetadata: _.get(siteData, &#39;site-metadata&#39;, {}),
                        pathPrefix: siteNode.pathPrefix,
                        data: _.omit(siteData, &#39;site-metadata&#39;)
                    }
                }
            };

            if (existingPageNode &amp;&amp; !_.get(page, &#39;context.menus&#39;)) {
                page.context.menus = _.get(existingPageNode, &#39;context.menus&#39;);
            }

            createPage(page);
        });
    });
};

```
&lt;/pre&gt;</code></pre>
        <h5 id="gatsby-source-data">Gatsby Source Data</h5>
        <pre><code>&lt;pre&gt;
```javascript

</code></pre>
        <div class="sourceCode" id="cb3">
            <pre
                class="sourceCode javascript"
            ><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">const</span> path <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;path&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">const</span> yaml <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;js-yaml&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="kw">const</span> fse <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;fs-extra&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="kw">const</span> chokidar <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;chokidar&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="kw">const</span> _ <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;lodash&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-6" title="6"></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="kw">const</span> metadataFileName <span class="op">=</span> <span class="st">&#39;site-metadata.json&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-8" title="8"></a>
<a class="sourceLine" id="cb3-9" title="9"><span class="kw">const</span> parsers <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-10" title="10">    <span class="dt">yaml</span><span class="op">:</span> (data) <span class="kw">=&gt;</span> <span class="va">yaml</span>.<span class="at">safeLoad</span>(data<span class="op">,</span> <span class="op">{</span> <span class="dt">schema</span><span class="op">:</span> <span class="va">yaml</span>.<span class="at">JSON_SCHEMA</span> <span class="op">}</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb3-11" title="11">    <span class="dt">json</span><span class="op">:</span> (data) <span class="kw">=&gt;</span> <span class="va">JSON</span>.<span class="at">parse</span>(data)</a>
<a class="sourceLine" id="cb3-12" title="12"><span class="op">};</span></a>
<a class="sourceLine" id="cb3-13" title="13"></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="kw">const</span> supportedExtensions <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-15" title="15">    <span class="dt">yaml</span><span class="op">:</span> <span class="va">parsers</span>.<span class="at">yaml</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-16" title="16">    <span class="dt">yml</span><span class="op">:</span> <span class="va">parsers</span>.<span class="at">yaml</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-17" title="17">    <span class="dt">json</span><span class="op">:</span> <span class="va">parsers</span>.<span class="at">json</span></a>
<a class="sourceLine" id="cb3-18" title="18"><span class="op">};</span></a>
<a class="sourceLine" id="cb3-19" title="19"></a>
<a class="sourceLine" id="cb3-20" title="20"><span class="va">exports</span>.<span class="at">sourceNodes</span> <span class="op">=</span> (props<span class="op">,</span> pluginOptions <span class="op">=</span> <span class="op">{}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-21" title="21">    <span class="kw">const</span> createContentDigest <span class="op">=</span> <span class="va">props</span>.<span class="at">createContentDigest</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-22" title="22">    <span class="kw">const</span> <span class="op">{</span> createNode <span class="op">}</span> <span class="op">=</span> <span class="va">props</span>.<span class="at">actions</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-23" title="23">    <span class="kw">const</span> reporter <span class="op">=</span> <span class="va">props</span>.<span class="at">reporter</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-24" title="24"></a>
<a class="sourceLine" id="cb3-25" title="25">    <span class="cf">if</span> (<span class="op">!</span><span class="va">_</span>.<span class="at">get</span>(pluginOptions<span class="op">,</span> <span class="st">&#39;path&#39;</span>)) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-26" title="26">        <span class="va">pluginOptions</span>.<span class="at">path</span> <span class="op">=</span> <span class="st">&#39;src/data&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-27" title="27">    <span class="op">}</span></a>
<a class="sourceLine" id="cb3-28" title="28"></a>
<a class="sourceLine" id="cb3-29" title="29">    <span class="cf">if</span> (<span class="op">!</span><span class="va">path</span>.<span class="at">isAbsolute</span>(<span class="va">pluginOptions</span>.<span class="at">path</span>)) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-30" title="30">        <span class="va">pluginOptions</span>.<span class="at">path</span> <span class="op">=</span> <span class="va">path</span>.<span class="at">resolve</span>(<span class="va">process</span>.<span class="at">cwd</span>()<span class="op">,</span> <span class="va">pluginOptions</span>.<span class="at">path</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-31" title="31">    <span class="op">}</span></a>
<a class="sourceLine" id="cb3-32" title="32"></a>
<a class="sourceLine" id="cb3-33" title="33">    <span class="va">reporter</span>.<span class="at">info</span>(<span class="vs">`[gatsby-source-data] setup file watcher and create site data`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-34" title="34"></a>
<a class="sourceLine" id="cb3-35" title="35">    <span class="kw">const</span> dataPath <span class="op">=</span> <span class="va">pluginOptions</span>.<span class="at">path</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-36" title="36">    <span class="kw">const</span> createSiteDataFromFilesPartial <span class="op">=</span> <span class="va">_</span>.<span class="at">partial</span>(createSiteDataFromFiles<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-37" title="37">        dataPath<span class="op">,</span></a>
<a class="sourceLine" id="cb3-38" title="38">        createNode<span class="op">,</span></a>
<a class="sourceLine" id="cb3-39" title="39">        createContentDigest<span class="op">,</span></a>
<a class="sourceLine" id="cb3-40" title="40">        reporter</a>
<a class="sourceLine" id="cb3-41" title="41">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-42" title="42">    <span class="kw">const</span> watcher <span class="op">=</span> <span class="va">chokidar</span>.<span class="at">watch</span>([dataPath<span class="op">,</span> metadataFileName]<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-43" title="43">        <span class="dt">cwd</span><span class="op">:</span> <span class="st">&#39;.&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-44" title="44">        <span class="dt">ignoreInitial</span><span class="op">:</span> <span class="kw">true</span></a>
<a class="sourceLine" id="cb3-45" title="45">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-46" title="46">    <span class="va">watcher</span>.<span class="at">on</span>(<span class="st">&#39;add&#39;</span><span class="op">,</span> createSiteDataFromFilesPartial)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-47" title="47">    <span class="va">watcher</span>.<span class="at">on</span>(<span class="st">&#39;change&#39;</span><span class="op">,</span> createSiteDataFromFilesPartial)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-48" title="48">    <span class="va">watcher</span>.<span class="at">on</span>(<span class="st">&#39;unlink&#39;</span><span class="op">,</span> createSiteDataFromFilesPartial)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-49" title="49"></a>
<a class="sourceLine" id="cb3-50" title="50">    <span class="cf">return</span> <span class="at">createSiteDataFromFiles</span>(<span class="op">{</span> dataPath<span class="op">,</span> createNode<span class="op">,</span> createContentDigest<span class="op">,</span> reporter <span class="op">},</span> <span class="kw">null</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-51" title="51"><span class="op">};</span></a>
<a class="sourceLine" id="cb3-52" title="52"></a>
<a class="sourceLine" id="cb3-53" title="53"><span class="kw">async</span> <span class="kw">function</span> <span class="at">createSiteDataFromFiles</span>(<span class="op">{</span> dataPath<span class="op">,</span> createNode<span class="op">,</span> createContentDigest<span class="op">,</span> reporter <span class="op">},</span> changedFile) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-54" title="54">    <span class="va">reporter</span>.<span class="at">info</span>(<span class="vs">`[gatsby-source-data] create site data from files, updated path: </span><span class="sc">${</span>changedFile<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-55" title="55">    <span class="kw">let</span> dataFiles <span class="op">=</span> []<span class="op">;</span></a>
<a class="sourceLine" id="cb3-56" title="56"></a>
<a class="sourceLine" id="cb3-57" title="57">    <span class="kw">const</span> dataPathExists <span class="op">=</span> <span class="cf">await</span> <span class="va">fse</span>.<span class="at">pathExists</span>(dataPath)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-58" title="58">    <span class="cf">if</span> (dataPathExists) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-59" title="59">        dataFiles <span class="op">=</span> <span class="cf">await</span> <span class="at">readDirRecursively</span>(dataPath)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-60" title="60">    <span class="op">}</span></a>
<a class="sourceLine" id="cb3-61" title="61"></a>
<a class="sourceLine" id="cb3-62" title="62">    <span class="kw">const</span> metadataPath <span class="op">=</span> <span class="va">path</span>.<span class="at">resolve</span>(metadataFileName)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-63" title="63">    <span class="kw">const</span> metadataExists <span class="op">=</span> <span class="cf">await</span> <span class="va">fse</span>.<span class="at">pathExists</span>(metadataPath)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-64" title="64">    <span class="cf">if</span> (metadataExists) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-65" title="65">        <span class="va">dataFiles</span>.<span class="at">push</span>(metadataFileName)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-66" title="66">    <span class="op">}</span></a>
<a class="sourceLine" id="cb3-67" title="67"></a>
<a class="sourceLine" id="cb3-68" title="68">    <span class="kw">const</span> sortedDataFiles <span class="op">=</span> <span class="va">dataFiles</span>.<span class="at">slice</span>().<span class="at">sort</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb3-69" title="69">    <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> <span class="at">convertDataFilesToJSON</span>(sortedDataFiles<span class="op">,</span> dataPath<span class="op">,</span> reporter)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-70" title="70"></a>
<a class="sourceLine" id="cb3-71" title="71">    <span class="at">createNode</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb3-72" title="72">        <span class="dt">id</span><span class="op">:</span> <span class="st">&#39;SiteData&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-73" title="73">        <span class="dt">parent</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-74" title="74">        <span class="dt">children</span><span class="op">:</span> []<span class="op">,</span></a>
<a class="sourceLine" id="cb3-75" title="75">        <span class="dt">data</span><span class="op">:</span> data<span class="op">,</span></a>
<a class="sourceLine" id="cb3-76" title="76">        <span class="dt">internal</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-77" title="77">            <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;SiteData&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-78" title="78">            <span class="dt">contentDigest</span><span class="op">:</span> <span class="at">createContentDigest</span>(<span class="va">JSON</span>.<span class="at">stringify</span>(data))<span class="op">,</span></a>
<a class="sourceLine" id="cb3-79" title="79">            <span class="dt">description</span><span class="op">:</span> <span class="vs">`Site data from </span><span class="sc">${</span><span class="va">path</span>.<span class="at">relative</span>(<span class="va">process</span>.<span class="at">cwd</span>()<span class="op">,</span> dataPath)<span class="sc">}</span><span class="vs">`</span></a>
<a class="sourceLine" id="cb3-80" title="80">        <span class="op">}</span></a>
<a class="sourceLine" id="cb3-81" title="81">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-82" title="82"><span class="op">}</span></a>
<a class="sourceLine" id="cb3-83" title="83"></a>
<a class="sourceLine" id="cb3-84" title="84"><span class="kw">async</span> <span class="kw">function</span> <span class="at">readDirRecursively</span>(dir<span class="op">,</span> options) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-85" title="85">    <span class="kw">const</span> rootDir <span class="op">=</span> <span class="va">_</span>.<span class="at">get</span>(options<span class="op">,</span> <span class="st">&#39;rootDir&#39;</span><span class="op">,</span> dir)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-86" title="86">    <span class="kw">const</span> files <span class="op">=</span> <span class="cf">await</span> <span class="va">fse</span>.<span class="at">readdir</span>(dir)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-87" title="87">    <span class="kw">const</span> promises <span class="op">=</span> <span class="va">_</span>.<span class="at">map</span>(files<span class="op">,</span> <span class="kw">async</span> (file) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-88" title="88">        <span class="kw">const</span> filePath <span class="op">=</span> <span class="va">path</span>.<span class="at">join</span>(dir<span class="op">,</span> file)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-89" title="89">        <span class="kw">const</span> stats <span class="op">=</span> <span class="cf">await</span> <span class="va">fse</span>.<span class="at">stat</span>(filePath)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-90" title="90">        <span class="cf">if</span> (<span class="va">stats</span>.<span class="at">isDirectory</span>()) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-91" title="91">            <span class="cf">return</span> <span class="at">readDirRecursively</span>(filePath<span class="op">,</span> <span class="op">{</span> rootDir <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-92" title="92">        <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> (<span class="va">stats</span>.<span class="at">isFile</span>()) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-93" title="93">            <span class="cf">return</span> <span class="va">path</span>.<span class="at">relative</span>(rootDir<span class="op">,</span> filePath)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-94" title="94">        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-95" title="95">            <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-96" title="96">        <span class="op">}</span></a>
<a class="sourceLine" id="cb3-97" title="97">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-98" title="98">    <span class="kw">const</span> recFiles <span class="op">=</span> <span class="cf">await</span> <span class="va">Promise</span>.<span class="at">all</span>(promises)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-99" title="99">    <span class="cf">return</span> <span class="va">_</span>.<span class="at">chain</span>(recFiles).<span class="at">compact</span>().<span class="at">flatten</span>().<span class="at">value</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb3-100" title="100"><span class="op">}</span></a>
<a class="sourceLine" id="cb3-101" title="101"></a>
<a class="sourceLine" id="cb3-102" title="102"><span class="kw">function</span> <span class="at">convertDataFilesToJSON</span>(dataFiles<span class="op">,</span> dataDirPath<span class="op">,</span> reporter) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-103" title="103">    <span class="kw">let</span> promises <span class="op">=</span> <span class="va">_</span>.<span class="at">map</span>(dataFiles<span class="op">,</span> (filePath) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-104" title="104">        <span class="kw">const</span> pathObject <span class="op">=</span> <span class="va">path</span>.<span class="at">parse</span>(filePath)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-105" title="105">        <span class="kw">const</span> absFilePath <span class="op">=</span> <span class="va">pathObject</span>.<span class="at">base</span> <span class="op">===</span> metadataFileName <span class="op">?</span> metadataFileName : <span class="va">path</span>.<span class="at">join</span>(dataDirPath<span class="op">,</span> filePath)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-106" title="106">        <span class="kw">const</span> relPath <span class="op">=</span> <span class="va">pathObject</span>.<span class="at">base</span> <span class="op">===</span> metadataFileName <span class="op">?</span> metadataFileName : filePath<span class="op">;</span></a>
<a class="sourceLine" id="cb3-107" title="107">        <span class="kw">const</span> relDir <span class="op">=</span> <span class="va">pathObject</span>.<span class="at">base</span> <span class="op">===</span> metadataFileName <span class="op">?</span> <span class="st">&#39;&#39;</span> : <span class="va">pathObject</span>.<span class="at">dir</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-108" title="108">        <span class="kw">const</span> ext <span class="op">=</span> <span class="va">pathObject</span>.<span class="va">ext</span>.<span class="at">substring</span>(<span class="dv">1</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-109" title="109">        <span class="cf">if</span> (<span class="op">!</span><span class="va">_</span>.<span class="at">has</span>(supportedExtensions<span class="op">,</span> ext)) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-110" title="110">            <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-111" title="111">        <span class="op">}</span></a>
<a class="sourceLine" id="cb3-112" title="112">        <span class="cf">return</span> <span class="va">fse</span>.<span class="at">readFile</span>(absFilePath).<span class="at">then</span>((data) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-113" title="113">            <span class="kw">const</span> propPath <span class="op">=</span> <span class="va">_</span>.<span class="at">compact</span>(<span class="va">relDir</span>.<span class="at">split</span>(<span class="va">path</span>.<span class="at">sep</span>).<span class="at">concat</span>(<span class="va">pathObject</span>.<span class="at">name</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb3-114" title="114">            <span class="kw">const</span> res <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb3-115" title="115">            <span class="cf">try</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-116" title="116">                <span class="kw">const</span> parsedData <span class="op">=</span> supportedExtensions[ext](data)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-117" title="117">                <span class="va">_</span>.<span class="at">set</span>(res<span class="op">,</span> propPath<span class="op">,</span> parsedData)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-118" title="118">            <span class="op">}</span> <span class="cf">catch</span> (err) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-119" title="119">                <span class="va">reporter</span>.<span class="at">warn</span>(<span class="vs">`[gatsby-source-data] could not parse file: </span><span class="sc">${</span>relPath<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-120" title="120">            <span class="op">}</span></a>
<a class="sourceLine" id="cb3-121" title="121">            <span class="cf">return</span> res<span class="op">;</span></a>
<a class="sourceLine" id="cb3-122" title="122">        <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-123" title="123">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-124" title="124">    <span class="cf">return</span> <span class="va">Promise</span>.<span class="at">all</span>(promises).<span class="at">then</span>((results) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-125" title="125">        <span class="cf">return</span> <span class="va">_</span>.<span class="at">reduce</span>(results<span class="op">,</span> (data<span class="op">,</span> res) <span class="kw">=&gt;</span> <span class="va">_</span>.<span class="at">merge</span>(data<span class="op">,</span> res)<span class="op">,</span> <span class="op">{}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-126" title="126">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-127" title="127"><span class="op">}</span></a></code></pre>
        </div>
        <div class="sourceCode" id="cb4">
            <pre
                class="sourceCode javascript"
            ><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1">&lt;/pre<span class="op">&gt;</span></a></code></pre>
        </div>
    </body>
</html>
